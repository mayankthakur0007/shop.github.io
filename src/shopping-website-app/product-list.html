<html><head></head><body><div hidden="" by-polymer-bundler=""><link rel="import" href="../../shared_bundle_1.html"></div><dom-module id="product-list"><template><style>paper-card{width:350px;margin:40px;height:610px;}</style><template is="dom-repeat" items="{{order}}"><paper-card image="[[_getImage(item.image)]]"><div class="card-content"><h4>Name : {{item.name}}</h4><h4>Category : {{item.category}}</h4><h4>Price : â‚¹{{item.price}}</h4></div><div class="card-actions"><template is="dom-if" if="{{login}}"><paper-button raised="" on-click="_handleBuy">Buy</paper-button></template><template is="dom-if" if="{{!login}}"><paper-button raised="" on-click="_handleLogin">Login To Buy</paper-button></template></div></paper-card></template><paper-toast id="added" text="Added to cart successfully"></paper-toast><iron-ajax id="ajax" on-response="_handleResponse" handle-as="json" content-type="application/json"></iron-ajax></template><script>var ProductList=/*#__PURE__*/function(_Polymer$Element){babelHelpers.inherits(ProductList,_Polymer$Element);function ProductList(){babelHelpers.classCallCheck(this,ProductList);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(ProductList).apply(this,arguments))}babelHelpers.createClass(ProductList,[{key:"connectedCallback",value:function connectedCallback(){babelHelpers.get(babelHelpers.getPrototypeOf(ProductList.prototype),"connectedCallback",this).call(this);this._getData()}/** getdata function for fetching the data from the database and showing it. Ajax request is done in pets
            
            for the data with sell property value "yes" only. This function is also called when any new pet is added 
            
            so that the list got again refreshed **/},{key:"_getData",value:function _getData(){this._makeAjax("http://localhost:3000/products","get",null)}},{key:"_handleBuy",value:function _handleBuy(event){var newEmail=sessionStorage.getItem("email"),obj={name:event.model.item.name,quantity:event.model.item.quantity,category:event.model.item.category,ownerEmail:newEmail,price:parseInt(event.model.item.price),image:event.model.item.image};sessionStorage.setItem("obj",JSON.stringify(obj));console.log(obj);this._makeAjax("http://localhost:3000/cart/?ownerEmail=".concat(newEmail),"get",null);this.action="Check"}},{key:"_handleLogin",value:function _handleLogin(){location.href=this.resolveUrl(" /login ")}},{key:"_makeAjax",value:function _makeAjax(url,method,postObj){var ajax=this.$.ajax;ajax.method=method;ajax.url=url;ajax.body=postObj?JSON.stringify(postObj):void 0;ajax.generateRequest()}},{key:"_getImage",value:function _getImage(image){return this.resolveUrl("./image/".concat(image))}// handling the response for every ajax call and refreshing the list based on that //
},{key:"_handleResponse",value:function _handleResponse(event){switch(this.action){case"List":this.order=event.detail.response;break;case"Buy":this.action="List";this._makeAjax("http://localhost:3000/products","get",null);break;case"Check":this.cart=event.detail.response;var check=JSON.parse(sessionStorage.getItem("obj"));if(0==this.cart.length){var obj={name:check.name,category:check.category,ownerEmail:check.ownerEmail,price:parseInt(check.price),quantity:parseInt(1),image:check.image};console.log(obj);this._makeAjax("http://localhost:3000/cart","post",obj);this.$.added.open();this.dispatchEvent(new CustomEvent("refresh-mylist",{detail:{},bubbles:!0,composed:!0}));this.action="list"}for(var i=0;i<this.cart.length;i++){if(this.cart[i].name==check.name){console.log("found");this.found="";var _obj={name:this.cart[i].name,category:this.cart[i].category,ownerEmail:this.cart[i].ownerEmail,price:parseInt(this.cart[i].price),quantity:parseInt(this.cart[i].quantity+1),image:this.cart[i].image};this._makeAjax("http://localhost:3000/cart/".concat(this.cart[i].id),"put",_obj);this.$.added.open();this.dispatchEvent(new CustomEvent("refresh-mylist",{detail:{},bubbles:!0,composed:!0}));this.action="list";break}else{this.found="notFound"}}if("notFound"===this.found){console.log("Not Found");var _obj2={name:check.name,category:check.category,ownerEmail:check.ownerEmail,price:parseInt(check.price),quantity:parseInt(1),image:check.image};this._makeAjax("http://localhost:3000/cart","post",_obj2);this.$.added.open();this.dispatchEvent(new CustomEvent("refresh-mylist",{detail:{},bubbles:!0,composed:!0}));this.action="list"}}}}],[{key:"is",get:function get(){return"product-list"}},{key:"properties",get:function get(){return{action:{type:String,value:"List"},order:{type:Array,value:[]},login:{type:String,value:sessionStorage.getItem("login")},cart:{type:Array},found:{type:String,value:"false"}}}}]);return ProductList}(Polymer.Element);window.customElements.define(ProductList.is,ProductList);</script></dom-module></body></html>